#+TITLE: "ubuntu14.04安装Atheros QCA61x4无线网卡驱动"
#+AUTHOR: wanglifeng
#+OPTIONS: H:4 ^:nil
#+LATEX_CLASS: latex-doc
#+PAGE_TAGS: driver
#+PAGE_CATETORIES: linux
#+PAGE_LAYOUT: post

#+HTML: <!--abstract-begin-->
本文联想K20-80安装完ubuntu，发现无法自动识别无线网卡驱动。经查这是ubuntu的bug，影响到联想多款笔记本电脑，链接: [[https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1436940][Atheros wifi 168c:0041(QCA6164) is not supported]] 。本文纪录按#34楼建议解决问题的步骤，供以后查阅。
#+HTML: <!--abstract-end-->

* 安装backports
** 下载并编译backports包

#+BEGIN_SRC sh
wget https://www.kernel.org/pub/linux/kernel/projects/backports/2015/07/31/backports-20150731.tar.gz
tar xvf backports-20150731.tar.gz
cd backports-20150731
#+END_SRC

** patch源代码

Patch the code with https://github.com/atondwal/linux/commit/22f8a4083883eca3e8a3175315d67d2a04392466

** 编译

#+BEGIN_SRC sh
make defconfig-ath10k
make
sudo make install
#+END_SRC

* 安装配置ath10k firmware

get the latest firmware from https://github.com/kvalo/ath10k-firmware/archive/master.zip
Unzip and copy ath10k folder to /lib/firmware/ath10k

Copy these two files (overwrite what you got before) in /lib/firmware/ath10k/QCA6164/hw2.1:
https://github.com/atondwal/ath10k-firmware/tree/master/ath10k/QCA6164/hw2.1

#+BEGIN_SRC sh
rm -rf /lib/firmware/ath10k/QCA6174/hw3.0/
#+END_SRC

Create a file named /etc/modprobe.d/ath10k.conf with the following line:

#+BEGIN_EXAMPLE
options ath10k_core skip_otp=y
#+END_EXAMPLE


* 测试

Reboot and modprobe ath10k_pci. Do "lshw -C network"; "ip link show" or "rfkill list" to see if you got your card working.
